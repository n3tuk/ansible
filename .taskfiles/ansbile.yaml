---
version: 3

tasks:
  ansible-lint:
    desc: Validation the schema of configuration files in the repository
    summary: |-
      Validate the layout and content of the YAML files in this repository
      using the JSON Schema files, including:

      - Taskfiles (Taskfile.yaml, .taskfiles/*.yaml)
      - GitHub Dependabot configuration (.github/dependabot.yaml)
      - GitHub Workflows (.github/workflows/*.yaml)
      - pre-commit Configuration (.pre-commit-config)
      - Ansible plays, tasks, and inventory files

      Checks on Kubernetes resources under the flux/ folder will be managed
      through the conform tasks using kubeconform, as although kubeconform still
      uses JSON Schemas, it is able to dynamocally find and process the schemas.

      $ task --summary conform
    silent: true
    sources:
      - plays/**.yaml
      - roles/**.yaml
    deps:
      - task: yamllint
    cmds:
      - cmd: |-
          ansible-lint \
            --format brief \
            --show-relpath \
            --config-file '{{ .root }}/.ansible-lint.yaml' \
            --strict
          echo -e '{{ .cg }}Passed{{ .cc }}'
